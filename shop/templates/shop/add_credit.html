{% extends "shop/base.html" %}

{% block title %}Add Udhari - Grocery Shop{% endblock %}

{% block content %}
    <h2>Add Udhari Entry</h2>

    <div class="card">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div class="form-group">
                        <label>Customer (dropdown)</label>
                        <select name="customer_id" class="form-control">
                            <option value="">-- Select Customer --</option>
                            {% for customer in customers %}
                                <option value="{{ customer.id }}">{{ customer.name }}{% if customer.phone %} ({{ customer.phone }}){% endif %}</option>
                            {% endfor %}
                        </select>
                        <small>Ya naya customer niche likho</small>
                        <input type="text" name="customer_name" class="form-control" placeholder="New customer name (optional)">
                    </div>
                    <div class="form-group">
                        <label>Customer Phone (optional)</label>
                        <input type="text" name="customer_phone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Item (Product dropdown)</label>
                        <select name="product_id" id="product-select" class="form-control">
                            <option value="">-- Select Product --</option>
                            {% for product in products %}
                                <option value="{{ product.id }}" data-price="{{ product.price }}">{{ product.name }}</option>
                            {% endfor %}
                        </select>
                        <small>Agar product list me nahi hai to niche item name likho</small>
                        <input type="text" name="item_name" class="form-control" placeholder="Custom item name (optional)">
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" name="quantity" id="quantity-input" class="form-control" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>Total Amount (auto calculate)</label>
                        <input type="number" step="0.01" name="amount" id="amount-input" class="form-control" value="0">
                    </div>
                </div>
                <div style="margin-top: 1rem; display: flex; justify-content: space-between;">
                    <a href="{% url 'credit_list' %}" class="btn btn-secondary">Back to Udhari List</a>
                    <button type="submit" class="btn">Save Udhari</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        (function() {
            const productSelect = document.getElementById('product-select');
            const quantityInput = document.getElementById('quantity-input');
            const amountInput = document.getElementById('amount-input');

            function recalcAmount() {
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                const price = parseFloat(selectedOption.getAttribute('data-price') || '0');
                const qty = parseFloat(quantityInput.value || '0');
                if (price > 0 && qty > 0) {
                    amountInput.value = (price * qty).toFixed(2);
                }
            }

            if (productSelect && quantityInput && amountInput) {
                productSelect.addEventListener('change', recalcAmount);
                quantityInput.addEventListener('input', recalcAmount);
            }
        })();
    </script>
{% endblock %}
